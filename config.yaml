# Patient Aggregation Configuration

# Patient identifier column name (used to group records)
patient_id_column: "patient_uid"

# Input files configuration
# Supported formats: .xlsx, .xls, .csv
# The system will automatically detect the file format
files:
  - name: "iop"
    file: "iop.xlsx"  # Can also be "iop.csv"
    columns:
      - name: "od_iop"
        type: "int"
        aggregation: "list"
      - name: "os_iop"
        type: "int"
        aggregation: "list"
  
  - name: "diagnosis"
    file: "diagnosis.xlsx"
    columns:
      - name: "source_severity"
        type: "str"
        aggregation: "list"
      - name: "code"
        type: "str"
        aggregation: "list"
      - name: "short_desc"
        type: "str"
        aggregation: "list"
  
  - name: "enc"
    file: "enc.xlsx"
    columns:
      - name: "bp_systolic"
        type: "int"
        aggregation: "list"
      - name: "bp_diastolic"
        type: "int"
        aggregation: "list"
      - name: "pulse"
        type: "int"
        aggregation: "list"

# Output configuration
output:
  format: "json_array"  # Options: json_array, comma_separated, pipe_separated
  directory: "output"  # Directory where all output files will be saved
  aggregated_file: "aggregated_patients.csv"  # Main aggregated output file

# Filtering and subsetting configuration
filtering:
  enabled: true  # Set to false to disable filtering
  subset_file: "aggregated_patients_subset.csv"  # Subset file name (saved in output directory)
  
  # Required columns: each patient must have at least min_count values
  required_columns:
    bp_systolic:
      min_count: 1  # At least 1 SBP measurement
      description: "Systolic blood pressure"
    bp_diastolic:
      min_count: 1  # At least 1 DBP measurement
      description: "Diastolic blood pressure"
    pulse:
      min_count: 1  # At least 1 HR measurement
      description: "Heart rate / pulse"
  
  # Group requirements: patient must have at least min_count values across the group
  group_requirements:
    - name: "iop_measurements"
      columns: ["od_iop", "os_iop"]  # At least one IOP value (either eye)
      min_count: 1
      description: "At least one IOP measurement from either eye"

